from pyrogram import Client, filters
from realesrgan import RealESRGAN
from PIL import Image
import os

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª
API_ID = 22257686  # Ø¶Ø¹ API_ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
API_HASH = "6fe90d5beeb1f4b01ddc58eaeee45343"  # Ø¶Ø¹ API_HASH Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
BOT_TOKEN = "8037285574:AAEGX5TgtFbZ5xr4jPdLdQC6hUQJ3aJj8mY"  # Ø¶Ø¹ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ

# Ù…Ø³Ø§Ø± Ù…Ø¤Ù‚Øª Ù„Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±
SAVE_PATH = "temp_images"
os.makedirs(SAVE_PATH, exist_ok=True)

# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª
app = Client("ai_image_enhancer", api_id=API_ID, api_hash=API_HASH, bot_token=BOT_TOKEN)

@app.on_message(filters.command("start") & filters.private)
async def start_message(_, message):
    await message.reply_text("Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ø±Ø³Ù„ Ù„ÙŠ ØµÙˆØ±Ø© ÙˆØ³Ø£Ù‚ÙˆÙ… Ø¨ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯ØªÙ‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ğŸ¤–âœ¨")

@app.on_message(filters.private & filters.photo)
async def enhance_image(_, message):
    try:
        # ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        file_path = await message.download(file_name=SAVE_PATH)
        image = Image.open(file_path)

        # ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Real-ESRGAN
        with RealESRGAN("x4") as model:
            enhanced_image = model.predict(image)

        # Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
        enhanced_path = file_path.replace(".jpg", "_enhanced.jpg")
        enhanced_image.save(enhanced_path)

        # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
        await message.reply_photo(enhanced_path, caption="ğŸ¤–âœ¨ ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ!")

        # Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        os.remove(file_path)
        os.remove(enhanced_path)

    except Exception as e:
        await message.reply_text(f"âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø©: {str(e)}")

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
if __name__ == "__main__":
    print("âœ… Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†!")
    app.run()
